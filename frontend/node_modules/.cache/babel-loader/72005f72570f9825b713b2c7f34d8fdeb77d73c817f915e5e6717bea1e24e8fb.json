{"ast":null,"code":"import React,{useEffect,useState}from'react';import{GoogleMap,InfoWindow,Marker,MarkerF}from'@react-google-maps/api';import\"./Map.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const containerStyle={width:'100%',height:'100%'};const defaultCenter={lat:37.5665,lng:126.9780};const Map=_ref=>{let{selectedFilters,gu,currentLat,currentLng}=_ref;const[currentPosition,setCurrentPosition]=useState(defaultCenter);const[allMarkers,setAllMarkers]=useState({});const[filteredMarkers,setFilteredMarkers]=useState([]);const[activeMarker,setActiveMarker]=useState(null);// 브라우저 지오로케이션 사용하여 위치 설정\nuseEffect(()=>{if('geolocation'in navigator){navigator.geolocation.getCurrentPosition(position=>{const{latitude,longitude}=position.coords;setCurrentPosition({lat:latitude,lng:longitude});},()=>{console.error(\"Geolocation is not supported or permission denied.\");setCurrentPosition(defaultCenter);// 권한 거부시 기본 위치 사용\n});}else{console.error(\"Geolocation is not supported by this browser.\");}},[]);// 좌표 값의 유효성 검사 및 위치 설정\nuseEffect(()=>{console.log(\"위치가 바뀌었어요:\",currentLat,currentLng);if(typeof currentLat==='number'&&typeof currentLng==='number'&&isFinite(currentLat)&&isFinite(currentLng)){setCurrentPosition({lat:currentLat,lng:currentLng});}},[currentLat,currentLng]);// 마커 데이터 가져오기\nconst fetchData=async category=>{try{const response=await fetch(\"/awes-api/searchOneCategory?address=\".concat(gu,\"&category=\").concat(category));if(!response.ok){throw new Error(\"HTTP error! status: \".concat(response.status));}const data=await response.json();const markersWithCategory=data.map(marker=>({...marker,category}));return{[category]:markersWithCategory};}catch(error){console.error(\"Failed to fetch data for category \".concat(category,\":\"),error);return{[category]:[]};}};// 모든 카테고리의 데이터 가져오기\nuseEffect(()=>{const fetchAllData=async()=>{const filtersNames=['관광거리','명소','문화','쇼핑','자연','음식','외국인'];const promises=filtersNames.map(category=>fetchData(category));const results=await Promise.all(promises);const allData=results.reduce((acc,curr)=>({...acc,...curr}),{});setAllMarkers(allData);};fetchAllData();},[gu]);// 선택된 필터에 따라 마커 필터링\nuseEffect(()=>{const filteredData=Object.keys(allMarkers).filter(key=>selectedFilters.includes(key)).flatMap(key=>allMarkers[key]);setFilteredMarkers(filteredData);},[selectedFilters,allMarkers]);const handleMarkerClick=marker=>{setActiveMarker(marker);};const handleInfoWindowClose=()=>{setActiveMarker(null);};return/*#__PURE__*/_jsxs(GoogleMap,{mapContainerStyle:containerStyle,center:currentPosition,zoom:13,children:[/*#__PURE__*/_jsx(MarkerF,{position:currentPosition,title:\"\\uD604\\uC7AC \\uC704\\uCE58\"}),filteredMarkers.map((marker,index)=>/*#__PURE__*/_jsx(Marker,{position:{lat:parseFloat(marker.latitude),lng:parseFloat(marker.longitude)},icon:markerIcons[marker.category]||\"http://maps.google.com/mapfiles/ms/icons/yellow-dot.png\",title:marker.name,onClick:()=>handleMarkerClick(marker)},index)),activeMarker&&/*#__PURE__*/_jsx(InfoWindow,{position:{lat:parseFloat(activeMarker.latitude),lng:parseFloat(activeMarker.longitude)},onCloseClick:handleInfoWindowClose,children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{children:activeMarker.name}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uC8FC\\uC18C: \",activeMarker.address]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uC804\\uD654\\uBC88\\uD638: \",activeMarker.phoneNumber]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uC6F9\\uC0AC\\uC774\\uD2B8: \",activeMarker.website]})]})})]});};export default Map;","map":{"version":3,"names":["React","useEffect","useState","GoogleMap","InfoWindow","Marker","MarkerF","jsx","_jsx","jsxs","_jsxs","containerStyle","width","height","defaultCenter","lat","lng","Map","_ref","selectedFilters","gu","currentLat","currentLng","currentPosition","setCurrentPosition","allMarkers","setAllMarkers","filteredMarkers","setFilteredMarkers","activeMarker","setActiveMarker","navigator","geolocation","getCurrentPosition","position","latitude","longitude","coords","console","error","log","isFinite","fetchData","category","response","fetch","concat","ok","Error","status","data","json","markersWithCategory","map","marker","fetchAllData","filtersNames","promises","results","Promise","all","allData","reduce","acc","curr","filteredData","Object","keys","filter","key","includes","flatMap","handleMarkerClick","handleInfoWindowClose","mapContainerStyle","center","zoom","children","title","index","parseFloat","icon","markerIcons","name","onClick","onCloseClick","address","phoneNumber","website"],"sources":["/Users/p_kxn_g/Documents/GitHub/awes0514/src/search/Map.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { GoogleMap, InfoWindow, Marker, MarkerF } from '@react-google-maps/api';\nimport \"./Map.css\";\n\nconst containerStyle = {\n  width: '100%',\n  height: '100%'\n};\n\nconst defaultCenter = {\n  lat: 37.5665,\n  lng: 126.9780\n};\n\nconst Map = ({ selectedFilters, gu, currentLat, currentLng }) => {\n  const [currentPosition, setCurrentPosition] = useState(defaultCenter);\n  const [allMarkers, setAllMarkers] = useState({});\n  const [filteredMarkers, setFilteredMarkers] = useState([]);\n  const [activeMarker, setActiveMarker] = useState(null);\n\n  // 브라우저 지오로케이션 사용하여 위치 설정\n  useEffect(() => {\n    if ('geolocation' in navigator) {\n      navigator.geolocation.getCurrentPosition((position) => {\n        const { latitude, longitude } = position.coords;\n        setCurrentPosition({\n          lat: latitude,\n          lng: longitude\n        });\n      }, () => {\n        console.error(\"Geolocation is not supported or permission denied.\");\n        setCurrentPosition(defaultCenter); // 권한 거부시 기본 위치 사용\n      });\n    } else {\n      console.error(\"Geolocation is not supported by this browser.\");\n    }\n  }, []);\n\n  // 좌표 값의 유효성 검사 및 위치 설정\n  useEffect(() => {\n    console.log(\"위치가 바뀌었어요:\", currentLat, currentLng);\n    if (typeof currentLat === 'number' && typeof currentLng === 'number' && isFinite(currentLat) && isFinite(currentLng)) {\n      setCurrentPosition({\n        lat: currentLat,\n        lng: currentLng\n      });\n    }\n  }, [currentLat, currentLng]);\n\n  // 마커 데이터 가져오기\n  const fetchData = async (category) => {\n    try {\n      const response = await fetch(`/awes-api/searchOneCategory?address=${gu}&category=${category}`);\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const data = await response.json();\n      const markersWithCategory = data.map(marker => ({ ...marker, category }));\n      return { [category]: markersWithCategory };\n    } catch (error) {\n      console.error(`Failed to fetch data for category ${category}:`, error);\n      return { [category]: [] };\n    }\n  };\n\n  // 모든 카테고리의 데이터 가져오기\n  useEffect(() => {\n    const fetchAllData = async () => {\n      const filtersNames = ['관광거리', '명소', '문화', '쇼핑', '자연', '음식', '외국인'];\n      const promises = filtersNames.map(category => fetchData(category));\n      const results = await Promise.all(promises);\n      const allData = results.reduce((acc, curr) => ({ ...acc, ...curr }), {});\n      setAllMarkers(allData);\n    };\n    fetchAllData();\n  }, [gu]);\n\n  // 선택된 필터에 따라 마커 필터링\n  useEffect(() => {\n    const filteredData = Object.keys(allMarkers)\n      .filter(key => selectedFilters.includes(key))\n      .flatMap(key => allMarkers[key]);\n    setFilteredMarkers(filteredData);\n  }, [selectedFilters, allMarkers]);\n\n  const handleMarkerClick = (marker) => {\n    setActiveMarker(marker);\n  };\n\n  const handleInfoWindowClose = () => {\n    setActiveMarker(null);\n  };\n\n  return (\n    <GoogleMap\n      mapContainerStyle={containerStyle}\n      center={currentPosition}\n      zoom={13}\n    >\n      <MarkerF position={currentPosition} title=\"현재 위치\" />\n\n      {filteredMarkers.map((marker, index) => (\n        <Marker\n          key={index}\n          position={{ lat: parseFloat(marker.latitude), lng: parseFloat(marker.longitude) }}\n          icon={markerIcons[marker.category] || \"http://maps.google.com/mapfiles/ms/icons/yellow-dot.png\"}\n          title={marker.name}\n          onClick={() => handleMarkerClick(marker)}\n        />\n      ))}\n      {activeMarker && (\n        <InfoWindow\n          position={{ lat: parseFloat(activeMarker.latitude), lng: parseFloat(activeMarker.longitude) }}\n          onCloseClick={handleInfoWindowClose}\n        >\n          <div>\n            <h4>{activeMarker.name}</h4>\n            <p>주소: {activeMarker.address}</p>\n            <p>전화번호: {activeMarker.phoneNumber}</p>\n            <p>웹사이트: {activeMarker.website}</p>\n          </div>\n        </InfoWindow>\n      )}\n    </GoogleMap>\n  );\n};\n\nexport default Map;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}