{"ast":null,"code":"import React,{useEffect,useState}from'react';import{GoogleMap,InfoWindow,Marker,MarkerF}from'@react-google-maps/api';import\"./Map.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const containerStyle={width:'100%',height:'100%'};const defaultCenter={lat:37.5665,lng:126.9780};const markerIcons={\"자연\":\"http://maps.google.com/mapfiles/ms/icons/green-dot.png\",\"쇼핑\":\"http://maps.google.com/mapfiles/ms/icons/blue-dot.png\",\"명소\":\"http://maps.google.com/mapfiles/ms/icons/pink-dot.png\",\"음식\":\"http://maps.google.com/mapfiles/ms/icons/orange-dot.png\",\"관광거리\":\"http://maps.google.com/mapfiles/ms/icons/purple-dot.png\",\"외국인\":\"http://maps.google.com/mapfiles/ms/icons/red-dot.png\",\"문화\":\"http://maps.google.com/mapfiles/ms/icons/yellow-dot.png\"};const Map=_ref=>{let{selectedFilters,gu,currentLat,currentLng}=_ref;const[currentPosition,setCurrentPosition]=useState(defaultCenter);const[allMarkers,setAllMarkers]=useState({});const[filteredMarkers,setFilteredMarkers]=useState([]);const[activeMarker,setActiveMarker]=useState(null);useEffect(()=>{setCurrentPosition({lat:currentLat,lng:currentLng});},[currentLat,currentLng]);const fetchData=async category=>{try{const response=await fetch(\"/awes-api/searchOneCategory?address=\".concat(gu,\"&category=\").concat(category));if(!response.ok){throw new Error(\"HTTP error! status: \".concat(response.status));}const data=await response.json();const markersWithCategory=data.map(marker=>({...marker,category}));return markersWithCategory;}catch(error){console.error(\"Failed to fetch data for category \".concat(category,\":\"),error);return[];}};const handleMarkerClick=async category=>{if(!allMarkers[category]||allMarkers[category].length===0){const categoryData=await fetchData(category);setAllMarkers(prevState=>({...prevState,[category]:categoryData}));}else{setFilteredMarkers(allMarkers[category]);}};useEffect(()=>{const filteredData=Object.keys(allMarkers).filter(key=>selectedFilters.includes(key)).flatMap(key=>allMarkers[key]);setFilteredMarkers(filteredData);},[selectedFilters,allMarkers]);const handleInfoWindowClose=()=>{setActiveMarker(null);};return/*#__PURE__*/_jsxs(GoogleMap,{mapContainerStyle:containerStyle,center:currentPosition,zoom:13,children:[/*#__PURE__*/_jsx(MarkerF,{position:currentPosition,title:\"\\uD604\\uC7AC \\uC704\\uCE58\"}),Object.keys(markerIcons).map((category,index)=>/*#__PURE__*/_jsx(Marker,{position:currentPosition// 마커의 위치는 임의로 설정, 클릭하면 데이터 불러옴\n,icon:markerIcons[category],title:category,onClick:()=>handleMarkerClick(category)},index)),filteredMarkers.map((marker,index)=>/*#__PURE__*/_jsx(Marker,{position:{lat:parseFloat(marker.latitude),lng:parseFloat(marker.longitude)},icon:markerIcons[marker.category]||\"http://maps.google.com/mapfiles/ms/icons/yellow-dot.png\",title:marker.name,onClick:()=>setActiveMarker(marker)},index)),activeMarker&&/*#__PURE__*/_jsx(InfoWindow,{position:{lat:parseFloat(activeMarker.latitude),lng:parseFloat(activeMarker.longitude)},onCloseClick:handleInfoWindowClose,children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{children:activeMarker.name}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uC8FC\\uC18C: \",activeMarker.address]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uC804\\uD654\\uBC88\\uD638: \",activeMarker.phoneNumber]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uC6F9\\uC0AC\\uC774\\uD2B8: \",activeMarker.website]})]})})]});};export default Map;","map":{"version":3,"names":["React","useEffect","useState","GoogleMap","InfoWindow","Marker","MarkerF","jsx","_jsx","jsxs","_jsxs","containerStyle","width","height","defaultCenter","lat","lng","markerIcons","Map","_ref","selectedFilters","gu","currentLat","currentLng","currentPosition","setCurrentPosition","allMarkers","setAllMarkers","filteredMarkers","setFilteredMarkers","activeMarker","setActiveMarker","fetchData","category","response","fetch","concat","ok","Error","status","data","json","markersWithCategory","map","marker","error","console","handleMarkerClick","length","categoryData","prevState","filteredData","Object","keys","filter","key","includes","flatMap","handleInfoWindowClose","mapContainerStyle","center","zoom","children","position","title","index","icon","onClick","parseFloat","latitude","longitude","name","onCloseClick","address","phoneNumber","website"],"sources":["/Users/p_kxn_g/Documents/GitHub/awes0514/src/search/Map.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { GoogleMap, InfoWindow, Marker, MarkerF } from '@react-google-maps/api';\nimport \"./Map.css\";\n\nconst containerStyle = {\n  width: '100%',\n  height: '100%'\n};\n\nconst defaultCenter = {\n  lat: 37.5665,\n  lng: 126.9780\n};\n\nconst markerIcons = {\n  \"자연\": \"http://maps.google.com/mapfiles/ms/icons/green-dot.png\",\n  \"쇼핑\": \"http://maps.google.com/mapfiles/ms/icons/blue-dot.png\",\n  \"명소\": \"http://maps.google.com/mapfiles/ms/icons/pink-dot.png\",\n  \"음식\": \"http://maps.google.com/mapfiles/ms/icons/orange-dot.png\",\n  \"관광거리\": \"http://maps.google.com/mapfiles/ms/icons/purple-dot.png\",\n  \"외국인\": \"http://maps.google.com/mapfiles/ms/icons/red-dot.png\",\n  \"문화\": \"http://maps.google.com/mapfiles/ms/icons/yellow-dot.png\"\n};\n\nconst Map = ({ selectedFilters ,gu, currentLat, currentLng}) => {\n  const [currentPosition, setCurrentPosition] = useState(defaultCenter);\n  const [allMarkers, setAllMarkers] = useState({});\n  const [filteredMarkers, setFilteredMarkers] = useState([]);\n  const [activeMarker, setActiveMarker] = useState(null);\n\n  useEffect(() => {\n    setCurrentPosition({\n      lat: currentLat,\n      lng: currentLng\n    });\n  }, [currentLat, currentLng]);\n\n  const fetchData = async (category) => {\n    try {\n      const response = await fetch(`/awes-api/searchOneCategory?address=${gu}&category=${category}`);\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const data = await response.json();\n      const markersWithCategory = data.map(marker => ({ ...marker, category }));\n      return markersWithCategory;\n    } catch (error) {\n      console.error(`Failed to fetch data for category ${category}:`, error);\n      return [];\n    }\n  };\n\n  const handleMarkerClick = async (category) => {\n    if (!allMarkers[category] || allMarkers[category].length === 0) {\n      const categoryData = await fetchData(category);\n      setAllMarkers(prevState => ({ ...prevState, [category]: categoryData }));\n    } else {\n      setFilteredMarkers(allMarkers[category]);\n    }\n  };\n\n  useEffect(() => {\n    const filteredData = Object.keys(allMarkers)\n      .filter(key => selectedFilters.includes(key))\n      .flatMap(key => allMarkers[key]);\n    setFilteredMarkers(filteredData);\n  }, [selectedFilters, allMarkers]);\n\n  const handleInfoWindowClose = () => {\n    setActiveMarker(null);\n  };\n\n  return (\n    <GoogleMap\n      mapContainerStyle={containerStyle}\n      center={currentPosition}\n      zoom={13}\n    >\n      <MarkerF position={currentPosition} title=\"현재 위치\" />\n\n      {Object.keys(markerIcons).map((category, index) => (\n        <Marker\n          key={index}\n          position={currentPosition} // 마커의 위치는 임의로 설정, 클릭하면 데이터 불러옴\n          icon={markerIcons[category]}\n          title={category}\n          onClick={() => handleMarkerClick(category)}\n        />\n      ))}\n\n      {filteredMarkers.map((marker, index) => (\n        <Marker\n          key={index}\n          position={{ lat: parseFloat(marker.latitude), lng: parseFloat(marker.longitude) }}\n          icon={markerIcons[marker.category] || \"http://maps.google.com/mapfiles/ms/icons/yellow-dot.png\"}\n          title={marker.name}\n          onClick={() => setActiveMarker(marker)}\n        />\n      ))}\n\n      {activeMarker && (\n        <InfoWindow\n          position={{ lat: parseFloat(activeMarker.latitude), lng: parseFloat(activeMarker.longitude) }}\n          onCloseClick={handleInfoWindowClose}\n        >\n          <div>\n            <h4>{activeMarker.name}</h4>\n            <p>주소: {activeMarker.address}</p>\n            <p>전화번호: {activeMarker.phoneNumber}</p>\n            <p>웹사이트: {activeMarker.website}</p>\n          </div>\n        </InfoWindow>\n      )}\n    </GoogleMap>\n  );\n};\n\nexport default Map;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}